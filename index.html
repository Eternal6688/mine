<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äºŒæ¬¡å…ƒç¾å›¾åˆ†äº«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 50%, #ff8fab 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Arial Rounded MT Bold', sans-serif;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        /* çˆ±å¿ƒè£…é¥° */
        .heart {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff6b9d;
            transform: rotate(45deg);
            opacity: 0.4;
            animation: float 15s infinite ease-in-out;
        }
        
        .heart:before, .heart:after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff6b9d;
            border-radius: 50%;
        }
        
        .heart:before { top: -10px; left: 0; }
        .heart:after { top: 0; left: -10px; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(45deg); }
            50% { transform: translateY(-20px) rotate(45deg); }
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            width: 90%;
            max-width: 440px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 10;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .title {
            font-size: 32px;
            color: #ff2e63;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 18px;
            color: #ff5c8a;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .image-container {
            width: 100%;
            height: 58vh;
            max-height: 390px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.4);
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.5);
        }
        
        #display-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #4a9eff;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loader-text {
            font-size: 20px;
            color: white;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 480px) {
            .title { font-size: 28px; }
            .subtitle { font-size: 16px; }
            .image-container { height: 50vh; }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <div class="loader-text">åŠ è½½èµ„æºä¸­...</div>
    </div>
    
    <!-- çˆ±å¿ƒè£…é¥° -->
    <div class="heart" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
    <div class="heart" style="top: 20%; right: 15%; animation-delay: 1s; width: 15px; height: 15px;"></div>
    <div class="heart" style="bottom: 15%; left: 15%; animation-delay: 2s; width: 25px; height: 25px;"></div>
    <div class="heart" style="bottom: 25%; right: 10%; animation-delay: 1.5s; width: 18px; height: 18px;"></div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
        <h1 class="title">äºŒæ¬¡å…ƒç¾å›¾åˆ†äº«</h1>
        <p class="subtitle">ç‚¹å‡»éšæœºåˆ‡æ¢å›¾ç‰‡</p>
        
        <div class="image-container">
            <img id="display-image" src="" alt="äºŒæ¬¡å…ƒç¾å›¾">
        </div>
    </div>
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="sound-effect" preload="auto"></audio>
    
    <script>
        // é…ç½®æ–‡ä»¶
        const CONFIG = {
            normalImages: ['1.jpg', '2.jpg', '3.jpg'],
            soundFile: '114.mp3',
            gifFile: '514.gif'
        };
        
        // çŠ¶æ€ç®¡ç†
        let state = {
            isResourcesLoaded: false,
            currentImageIndex: -1,
            isPlayingEffect: false,
            hasUserInteracted: false,
            resourcesToLoad: 5, // 3å¼ å›¾ç‰‡ + 1éŸ³é¢‘ + 1GIF
            resourcesLoaded: 0
        };
        
        // DOMå…ƒç´ 
        const dom = {
            loader: document.getElementById('loader'),
            displayImage: document.getElementById('display-image'),
            soundElement: document.getElementById('sound-effect'),
            mainContainer: document.querySelector('.main-container')
        };
        
        // å·¥å…·å‡½æ•°ï¼šæ›´æ–°åŠ è½½è¿›åº¦
        function updateResourceProgress(resourceName) {
            state.resourcesLoaded++;
            console.log(`âœ… ${resourceName} åŠ è½½å®Œæˆ (${state.resourcesLoaded}/${state.resourcesToLoad})`);
            
            if (state.resourcesLoaded >= state.resourcesToLoad) {
                setTimeout(() => {
                    dom.loader.classList.add('hidden');
                    state.isResourcesLoaded = true;
                    console.log('ğŸ‰ æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼');
                    
                    // æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
                    loadRandomImage(true);
                }, 500);
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šåŠ è½½éšæœºå›¾ç‰‡
        function loadRandomImage(isFirstLoad = false) {
            let newIndex;
            if (CONFIG.normalImages.length === 1) {
                newIndex = 0;
            } else {
                do {
                    newIndex = Math.floor(Math.random() * CONFIG.normalImages.length);
                } while (newIndex === state.currentImageIndex && CONFIG.normalImages.length > 1);
            }
            
            state.currentImageIndex = newIndex;
            dom.displayImage.src = CONFIG.normalImages[newIndex];
            
            if (isFirstLoad) {
                dom.displayImage.onload = () => {
                    console.log(`ğŸ–¼ï¸ åˆå§‹å›¾ç‰‡åŠ è½½å®Œæˆ: ${CONFIG.normalImages[newIndex]}`);
                };
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ’­æ”¾éŸ³é¢‘
        function playSound() {
            if (!dom.soundElement.src) {
                dom.soundElement.src = CONFIG.soundFile;
            }
            
            dom.soundElement.volume = 1.0;
            dom.soundElement.currentTime = 0;
            
            const playPromise = dom.soundElement.play();
            
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.warn('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                    
                    // å¦‚æœæ˜¯è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼Œå°è¯•é™ä½éŸ³é‡å¹¶é™éŸ³æ’­æ”¾ä¸€æ¬¡ä»¥è§£é”
                    if (error.name === 'NotAllowedError' && !state.hasUserInteracted) {
                        dom.soundElement.volume = 0.001;
                        dom.soundElement.play().then(() => {
                            state.hasUserInteracted = true;
                            dom.soundElement.pause();
                            dom.soundElement.currentTime = 0;
                            dom.soundElement.volume = 1.0;
                        }).catch(e => console.log('è§£é”éŸ³é¢‘å¤±è´¥:', e));
                    }
                });
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šåœæ­¢éŸ³é¢‘
        function stopSound() {
            try {
                dom.soundElement.pause();
                dom.soundElement.currentTime = 0;
            } catch (error) {
                console.log('åœæ­¢éŸ³é¢‘æ—¶å‡ºé”™:', error);
            }
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºGIFå¹¶è‡ªåŠ¨ç§»é™¤
        function showAndRemoveGif() {
            // åˆ›å»ºä¸´æ—¶GIFå®¹å™¨
            const gifContainer = document.createElement('div');
            gifContainer.style.position = 'fixed';
            gifContainer.style.top = '0';
            gifContainer.style.left = '0';
            gifContainer.style.width = '100%';
            gifContainer.style.height = '100%';
            gifContainer.style.backgroundColor = '#000';
            gifContainer.style.zIndex = '9999';
            gifContainer.style.display = 'flex';
            gifContainer.style.justifyContent = 'center';
            gifContainer.style.alignItems = 'center';
            gifContainer.style.pointerEvents = 'none';
            
            // åˆ›å»ºGIFå›¾ç‰‡
            const gifImage = new Image();
            gifImage.src = CONFIG.gifFile + '?t=' + Date.now(); // é¿å…ç¼“å­˜
            gifImage.style.width = '100%';
            gifImage.style.height = '100%';
            gifImage.style.objectFit = 'cover';
            
            gifContainer.appendChild(gifImage);
            document.body.appendChild(gifContainer);
            
            // 1.5ç§’åç§»é™¤GIFå¹¶åœæ­¢éŸ³é¢‘
            setTimeout(() => {
                if (gifContainer.parentNode) {
                    gifContainer.remove();
                }
                // åŒæ­¥åœæ­¢éŸ³é¢‘
                stopSound();
                state.isPlayingEffect = false;
            }, 1500); // ç²¾ç¡®1.5ç§’
        }
        
        // ä¸»ç‚¹å‡»å¤„ç†å‡½æ•°
        function handleClick() {
            // å¦‚æœèµ„æºæœªåŠ è½½å®Œæˆæˆ–æ­£åœ¨æ’­æ”¾æ•ˆæœï¼Œå¿½ç•¥ç‚¹å‡»
            if (!state.isResourcesLoaded || state.isPlayingEffect) {
                console.log(state.isResourcesLoaded ? 'â³ æ•ˆæœæ’­æ”¾ä¸­ï¼Œè¯·ç¨å€™...' : 'âŒ› èµ„æºåŠ è½½ä¸­...');
                return;
            }
            
            state.isPlayingEffect = true;
            
            // ç¬¬ä¸€æ­¥ï¼šåˆ‡æ¢å›¾ç‰‡
            loadRandomImage();
            
            // ç¬¬äºŒæ­¥ï¼šæ’­æ”¾éŸ³é¢‘
            playSound();
            
            // ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç¤ºGIFï¼ˆ1.5ç§’åè‡ªåŠ¨ç§»é™¤å¹¶åœæ­¢éŸ³é¢‘ï¼‰
            showAndRemoveGif();
        }
        
        // åˆå§‹åŒ–èµ„æºåŠ è½½
        function initializeResources() {
            console.log('ğŸš€ å¼€å§‹åŠ è½½èµ„æº...');
            
            // é¢„åŠ è½½ä¸‰å¼ å›¾ç‰‡
            CONFIG.normalImages.forEach((imgSrc, index) => {
                const img = new Image();
                img.src = imgSrc;
                
                img.onload = () => {
                    updateResourceProgress(`å›¾ç‰‡ ${imgSrc}`);
                };
                
                img.onerror = () => {
                    console.error(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${imgSrc}`);
                    updateResourceProgress(`å›¾ç‰‡ ${imgSrc} (å¤±è´¥)`);
                };
            });
            
            // é¢„åŠ è½½éŸ³é¢‘
            const audio = new Audio();
            audio.src = CONFIG.soundFile;
            audio.preload = 'auto';
            
            audio.addEventListener('canplaythrough', () => {
                updateResourceProgress('éŸ³é¢‘æ–‡ä»¶');
            });
            
            audio.addEventListener('error', () => {
                console.error('âŒ éŸ³é¢‘åŠ è½½å¤±è´¥');
                updateResourceProgress('éŸ³é¢‘æ–‡ä»¶ (å¤±è´¥)');
            });
            
            // é¢„åŠ è½½GIF
            const gif = new Image();
            gif.src = CONFIG.gifFile;
            
            gif.onload = () => {
                updateResourceProgress('GIFæ–‡ä»¶');
            };
            
            gif.onerror = () => {
                console.error('âŒ GIFåŠ è½½å¤±è´¥');
                updateResourceProgress('GIFæ–‡ä»¶ (å¤±è´¥)');
            };
        }
        
        // åˆå§‹åŒ–åº”ç”¨ç¨‹åº
        function initializeApp() {
            // è®¾ç½®éŸ³é¢‘å…ƒç´ 
            dom.soundElement.src = CONFIG.soundFile;
            dom.soundElement.volume = 1.0;
            dom.soundElement.preload = 'auto';
            
            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', handleClick);
            document.addEventListener('touchstart', handleClick, { passive: false });
            
            // ç”¨æˆ·äº¤äº’æ—¶è§£é”éŸ³é¢‘
            const unlockAudio = () => {
                if (!state.hasUserInteracted) {
                    state.hasUserInteracted = true;
                    console.log('ğŸ‘† ç”¨æˆ·äº¤äº’ï¼ŒéŸ³é¢‘å·²è§£é”');
                }
            };
            
            document.addEventListener('click', unlockAudio, { once: true });
            document.addEventListener('touchstart', unlockAudio, { once: true });
            
            // å¼€å§‹åŠ è½½èµ„æº
            initializeResources();
        }
        
        // å¯åŠ¨åº”ç”¨ç¨‹åº
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // é˜²æ­¢ç§»åŠ¨ç«¯ä¸‹æ‹‰åˆ·æ–°
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
